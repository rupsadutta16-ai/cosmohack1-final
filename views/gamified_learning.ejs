<%- include('partials/header', { title: 'Gamified Challenges - SecureGuard' })
%> <%- include('partials/sidebar', { page: 'gamified_learning' }) %>

<div class="main-content">
  <div class="game-container">
    <section class="hero fade-in-left">
      <h1>
        <span style="-webkit-text-fill-color: initial; background: none"
          >ğŸš€</span
        >
        <span style="text-shadow: 0 0 20px rgba(252, 211, 77, 0.2)">
          Gamified Cyber Challenges
        </span>
      </h1>
      <p>
        Compete in weekly and monthly events. Rise to the top, earn massive XP,
        and claim your rewards.
      </p>

      <div class="stats">
        <div class="stat-card">
          <span>ğŸ”¥ Total XP</span>
          <h3><%= user.experiencePoints %></h3>
        </div>
        <div class="stat-card">
          <span>â­ Level</span>
          <h3><%= user.level %></h3>
        </div>
        <div class="stat-card">
          <span>ğŸ† Global Rank</span>
          <h3>#<%= user.rank %></h3>
        </div>
      </div>
    </section>

    <section class="challenge-section fade-in-up">
      <div class="section-header">
        <h2>ğŸ“… <span> Weekly Sprints </span></h2>
        <span class="live-indicator">â— LIVE NOW</span>
      </div>

      <div class="challenge-card active-card">
        <div class="card-badge weekly">This Week</div>
        <div class="content">
          <div class="header">
            <h3><%= weeklyChallenges.active.title %></h3>
            <span class="xp-badge"
              >âš¡ <%= weeklyChallenges.active.xp %> XP</span
            >
          </div>
          <p><%= weeklyChallenges.active.description %></p>

          <div class="meta-row">
            <div class="date">
              <span
                >ğŸ•’ <%= weeklyChallenges.active.startDate %> - <%=
                weeklyChallenges.active.endDate %></span
              >
            </div>
            <div class="winner-status">
              <span>ğŸ† Winner: <strong>TBD</strong></span>
            </div>
          </div>
        </div>
        <div class="action">
          <form action="/missions/start/w-active" method="POST">
            <button type="submit" class="btn-challenge">Enter Challenge</button>
          </form>
        </div>
      </div>

      <div class="sub-challenges-grid">
        <% weeklyChallenges.upcoming.forEach(c => { %>
        <div class="challenge-card upcoming">
          <div class="card-status">Upcoming</div>
          <h4><%= c.title %></h4>
          <p class="date"><%= c.startDate %></p>
          <span class="xp-mini">+<%= c.xp %> XP</span>
        </div>
        <% }) %> <% weeklyChallenges.past.forEach(c => { %>
        <div class="challenge-card past">
          <div class="card-status done">Ended</div>
          <h4><%= c.title %></h4>
          <div class="winner-banner">
            ğŸ† Winner: <span class="winner-name"><%= c.winner %></span>
          </div>
          <p class="date"><%= c.startDate %></p>
        </div>
        <% }) %>
      </div>
    </section>

    <section class="challenge-section fade-in-up" style="margin-top: 3rem">
      <div class="section-header">
        <h2 class="heading-purple">ğŸŒ• Monthly Operations</h2>
      </div>

      <div class="challenge-card active-card monthly-theme">
        <div class="card-badge monthly">Current Month</div>
        <div class="content">
          <div class="header">
            <h3><%= monthlyChallenges.active.title %></h3>
            <span class="xp-badge"
              >ğŸ’ <%= monthlyChallenges.active.xp %> XP</span
            >
          </div>
          <p><%= monthlyChallenges.active.description %></p>

          <div class="meta-row">
            <div class="date">
              <span
                >ğŸ—“ï¸ <%= monthlyChallenges.active.startDate %> - <%=
                monthlyChallenges.active.endDate %></span
              >
            </div>
            <div class="winner-status">
              <span>ğŸ† Winner: <strong>TBD</strong></span>
            </div>
          </div>
        </div>
        <div class="action">
          <form action="/missions/start/m-active" method="POST">
            <button type="submit" class="btn-challenge">Join Operation</button>
          </form>
        </div>
      </div>

      <div class="sub-challenges-grid">
        <% monthlyChallenges.upcoming.forEach(c => { %>
        <div class="challenge-card upcoming">
          <div class="card-status">Next Month</div>
          <h4><%= c.title %></h4>
          <span class="xp-mini">+<%= c.xp %> XP</span>
        </div>
        <% }) %> <% monthlyChallenges.past.forEach(c => { %>
        <div class="challenge-card past">
          <div class="card-status done">Ended</div>
          <h4><%= c.title %></h4>
          <div class="winner-banner">
            ğŸ† Winner: <span class="winner-name"><%= c.winner %></span>
          </div>
        </div>
        <% }) %>
      </div>
    </section>

    <section class="missions fade-in-up" style="margin-top: 4rem">
      <h2>ğŸ¯ Daily Quick Tasks</h2>
      <div class="mission-grid">
        <% missions.forEach(mission => { %>
        <div class="mission-card <%= mission.difficulty %>">
          <span class="xp">+<%= mission.xp %> XP</span>
          <h3><%= mission.title %></h3>
          <p><%= mission.description %></p>
          <form action="/daily-challenge" method="GET">
            <button type="submit">Start</button>
          </form>
        </div>
        <% }) %>
      </div>
    </section>

    <section class="achievements fade-in-up">
      <h2>ğŸ† Badge Collection</h2>
      <div class="badge-grid">
        <% achievements.forEach(badge => { %>
        <div class="badge <%= badge.unlocked ? 'unlocked' : 'locked' %>">
          <div class="badge-icon"><%= badge.icon %></div>
          <div class="badge-name"><%= badge.name %></div>
        </div>
        <% }) %>
      </div>
    </section>
  </div>
</div>

<%- include('partials/footer') %>
