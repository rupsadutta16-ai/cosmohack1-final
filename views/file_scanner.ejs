<%- include('partials/header', { title: 'File Scanner - SecureGuard' }) %> <%-
include('partials/sidebar', { page: 'file-scanner' }) %>

<div class="main-content">
  <div class="container">
    <div class="fade-in-left">
      <h1 class="text-gradient-emerald">üìÅ File Malware Scanner</h1>
      <p style="color: #64748b; margin-top: 0.5rem">
        Upload files to scan for malware, viruses, and threats
      </p>
    </div>

    <div class="glass-card card-emerald fade-in-up" style="margin-top: 2rem">
      <form id="fileScanForm" enctype="multipart/form-data">
        <div class="form-group">
          <label class="form-label" for="file">Upload File (Max 10MB)</label>
          <input
            type="file"
            id="file"
            name="file"
            class="form-input"
            required
            style="padding: 1rem"
          />
          <p style="color: #64748b; font-size: 0.85rem; margin-top: 0.5rem">
            Supported: .exe, .pdf, .doc, .zip, .js, .html, etc.
          </p>
        </div>
        <button type="submit" class="btn btn-primary">Scan File</button>
      </form>
    </div>

    <div
      id="scanResults"
      style="display: none"
      class="glass-card fade-in-up"
      style="margin-top: 2rem"
    >
      <h3 style="color: var(--light-emerald); margin-bottom: 1.5rem">
        Scan Results
      </h3>
      <div id="resultsContent"></div>
    </div>
  </div>
</div>

<script>
  document
    .getElementById("fileScanForm")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const resultsDiv = document.getElementById("scanResults");
      const resultsContent = document.getElementById("resultsContent");

      resultsContent.innerHTML = '<div class="loading">Scanning file...</div>';
      resultsDiv.style.display = "block";

      try {
        const response = await fetch("/api/scan-file", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();

        resultsContent.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">${
                      data.clean ? "‚úÖ" : "üö®"
                    }</div>
                    <div class="stat-label">Status</div>
                    <div style="color: ${
                      data.clean ? "var(--light-emerald)" : "#FCA5A5"
                    }; font-weight: 600; margin-top: 0.5rem;">
                        ${data.clean ? "Clean" : "Malware Detected"}
                    </div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                    <div class="stat-label">File Size</div>
                    <div style="color: #94A3B8; font-weight: 600; margin-top: 0.5rem;">${
                      data.fileSize
                    }</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üîç</div>
                    <div class="stat-label">Detections</div>
                    <div style="color: var(--light-gold); font-weight: 600; margin-top: 0.5rem;">${
                      data.detections
                    }/50</div>
                </div>
            </div>
            <div style="background: rgba(30, 41, 59, 0.5); padding: 1.5rem; border-radius: 12px; border-left: 4px solid ${
              data.clean ? "var(--primary-emerald)" : "#EF4444"
            };">
                <h4 style="color: var(--light-emerald); margin-bottom: 1rem;">Detection Details</h4>
                <ul style="color: #CBD5E1; line-height: 1.8;">
                    ${data.details.map((d) => `<li>${d}</li>`).join("")}
                </ul>
            </div>
        `;
      } catch (error) {
        resultsContent.innerHTML =
          '<div class="alert alert-error">Error scanning file. Please try again.</div>';
      }
    });
</script>

<%- include('partials/footer') %>
