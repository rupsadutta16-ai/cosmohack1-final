<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    <%= title || 'Phishing Awareness Tool' %>
  </title>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/enhanced.css" />
  <link rel="stylesheet" href="/css/gamified_learning.css" />
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Theme toggle - runs immediately
    const savedTheme = sessionStorage.getItem("theme") || "dark";
    document.documentElement.setAttribute("data-theme", savedTheme);
    if (savedTheme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    document.addEventListener("DOMContentLoaded", function () {
      // Theme toggle button
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.querySelector(".theme-icon");

      if (themeIcon)
        themeIcon.textContent = savedTheme === "light" ? "üåô" : "‚òÄÔ∏è";

      if (themeToggle) {
        themeToggle.addEventListener("click", function () {
          const currentTheme =
            document.documentElement.getAttribute("data-theme");
          const newTheme = currentTheme === "light" ? "dark" : "light";

          sessionStorage.setItem("theme", newTheme);

          // Apply new theme immediately without reload
          document.documentElement.setAttribute("data-theme", newTheme);
          if (newTheme === 'dark') {
            document.documentElement.classList.add('dark');
            if (themeIcon) themeIcon.textContent = "‚òÄÔ∏è";
          } else {
            document.documentElement.classList.remove('dark');
            if (themeIcon) themeIcon.textContent = "üåô";
          }
        });
      }
    });

    // Sidebar toggle - runs after full page load
    window.addEventListener("load", function () {
      const toggleBtn = document.getElementById("sidebarToggle");
      const sidebar = document.querySelector(".sidebar");
      const mainContent = document.querySelector(".main-content");

      if (toggleBtn) {
        toggleBtn.addEventListener("click", function () {
          this.classList.toggle("active");
          if (sidebar) sidebar.classList.toggle("collapsed");
          if (mainContent) mainContent.classList.toggle("expanded");
        });
      }

      // Close sidebar when clicking outside on mobile
      if (window.innerWidth <= 768) {
        document.addEventListener("click", function (e) {
          if (
            sidebar &&
            !sidebar.contains(e.target) &&
            !toggleBtn.contains(e.target)
          ) {
            if (!sidebar.classList.contains("collapsed")) {
              sidebar.classList.add("collapsed");
              if (toggleBtn) toggleBtn.classList.remove("active");
            }
          }
        });
      }
    });
  </script>
</head>

<body>
  <nav class="navbar">
    <div class="nav-container">
      <div style="display: flex; align-items: center; gap: 1rem">
        <% if (typeof page==='undefined' || page !=='landing' ) { %>
          <!-- Sidebar toggle button -->
          <button id="sidebarToggle" class="sidebar-toggle">
            <span></span><span></span><span></span>
          </button>
          <% } %>

            <a href="/dashboard" class="nav-brand">SecureGuard</a>
      </div>
      <ul class="nav-links">
        <li><a href="/about-us">About Us</a></li>
        <li><a href="/pricing">Pricing</a></li>
        <li><a href="/support-center">Support Center</a></li>

        <li>
          <button id="themeToggle" class="theme-toggle" title="Toggle theme">
            <span class="theme-icon">üåô</span>
          </button>
        </li>
        <% if (page !=='landing' ) { %>
          <% if (typeof user !=='undefined' && user) { %>
            <li style="color: #64748b; padding: 0.5rem 1rem; font-size: 0.85rem">
              üë§ <%= user.fullName || user.username %>
            </li>
            <li>
              <a href="/logout" style="background: rgba(239, 68, 68, 0.1); color: #fca5a5">
                Logout
              </a>
            </li>
            <% } else { %>
              <li><a href="/login">Log In</a></li>
              <li><a href="/signup">Sign Up</a></li>
              <% } %>
                <% } else { %>
                  <!-- Landing page -->
                  <li><a href="/login">Log In</a></li>
                  <li><a href="/signup">Sign Up</a></li>
                  <% } %>
      </ul>
    </div>
  </nav>