<%- include('partials/header', { title: 'Campaigns - PhishGuard' }) %> <%-
include('partials/sidebar', { page: 'campaigns' }) %>

<div class="main-content">
  <div class="container">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3rem;
      "
    >
      <div style="display: flex; align-items: center">
        <div style="font-size: 2rem; margin-right: 1rem">ðŸŽ¯</div>
        <h1 style="margin: 0">Campaign Management</h1>
      </div>
      <a href="/campaigns/new" class="btn btn-primary pulse">+ New Campaign</a>
    </div>

    <div class="glass-card sparkle">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Campaign Name</th>
              <th>Template</th>
              <th>Target Group</th>
              <th>Status</th>
              <th>Sent</th>
              <th>Clicked</th>
              <th>Click Rate</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (campaigns && campaigns.length > 0) { %> <%
            campaigns.forEach(campaign => { %>
            <tr>
              <td><%= campaign.name %></td>
              <td><%= campaign.template %></td>
              <td><%= campaign.targetGroup %></td>
              <td>
                <span
                  class="badge badge-<%= campaign.status.toLowerCase() %> pulse"
                >
                  <%= campaign.status %>
                </span>
              </td>
              <td><%= campaign.sent || 0 %></td>
              <td><%= campaign.clicked || 0 %></td>
              <td>
                <%= campaign.sent > 0 ? Math.round((campaign.clicked /
                campaign.sent) * 100) : 0 %>%
              </td>
              <td>
                <a
                  href="/campaigns/<%= campaign.id %>"
                  class="btn btn-secondary"
                  style="padding: 0.5rem"
                  >View</a
                >
                <% if (campaign.status === 'Draft') { %>
                <button
                  onclick="launchCampaign(<%= campaign.id %>)"
                  class="btn btn-primary"
                  style="padding: 0.5rem"
                >
                  Launch
                </button>
                <% } %>
              </td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="8" style="text-align: center; color: #aaa">
                No campaigns found.
                <a href="/campaigns/new">Create your first campaign</a>
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  function launchCampaign(campaignId) {
    if (
      confirm(
        "Are you sure you want to launch this campaign? This will send emails to all target users."
      )
    ) {
      fetch(`/campaigns/${campaignId}/launch`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      }).then((response) => {
        if (response.ok) {
          location.reload();
        } else {
          alert("Error launching campaign");
        }
      });
    }
  }
</script>

<%- include('partials/footer') %>
